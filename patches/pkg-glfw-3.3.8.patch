From 7c188261dfc6e3251af2231f59aec3c86d20de8a Mon Sep 17 00:00:00 2001
From: MarcasRealAccount <thetremine.lumicks@gmail.com>
Date: Fri, 16 Dec 2022 01:35:32 +0100
Subject: [PATCH] Add premake scripts :>

---
 build.lua | 34 ++++++++++++++++++++++++++++++++++
 dep.lua   | 16 ++++++++++++++++
 2 files changed, 50 insertions(+)
 create mode 100644 build.lua
 create mode 100644 dep.lua

diff --git a/build.lua b/build.lua
new file mode 100644
index 0000000..49accfb
--- /dev/null
+++ b/build.lua
@@ -0,0 +1,34 @@
+local scriptDir = common:scriptDir()
+
+if common.host == "windows" then
+	function msbuildConfiguration(msbuild, configuration, outputConfig, suffix)
+		if os.executef("%q \"%s\\build\\GLFW.sln\" -p:Configuration=%s -m", msbuild, scriptDir, configuration) > 0 then
+			error(string.format("Failed to build %s configuration for glfw-3.3.8", configuration))
+		end
+		
+		common:copyFile(string.format("%s\\build\\src\\%s\\glfw3.lib", scriptDir, configuration), string.format("%s\\Bin\\%s-%s-%s\\glfw3%s.lib", scriptDir, common.host, common.arch, outputConfig, suffix or ""))
+	end
+	
+	local versionId = tonumber(os.outputof("\"C:\Program Files (x86)\Microsoft Visual Studio\Installer\vswhere.exe\" -prerelease -latest -property catalog_productLine"):gmatch("%d+"))
+	local version   = tonumber(os.outputof("\"C:\Program Files (x86)\Microsoft Visual Studio\Installer\vswhere.exe\" -prerelease -latest -property catalog_productLineVersion"))
+	local path      = os.outputof("\"C:\Program Files (x86)\Microsoft Visual Studio\Installer\vswhere.exe\" -prerelease -latest -property installationPath")
+	local buildTool = string.format("Visual Studio %d %d", versionId, version)
+	
+	if os.executef("cmake -S \"%s/\" -B \"%s/build/\" -G %q -D GLFW_USE_WAYLAND=1 -D USE_MSVC_RUNTIME_LIBRARY_DLL=1", scriptDir, scriptDir, buildTool) > 1 then
+		error("Failed to run cmake for glfw-3.3.8")
+	end
+	
+	msbuildConfiguration(string.format("%s\\MSBuild\\Current\\Bin\\MSBuild.exe", path), "Debug", "Debug")
+	msbuildConfiguration(string.format("%s\\MSBuild\\Current\\Bin\\MSBuild.exe", path), "RelWithDebInfo", "Release")
+	msbuildConfiguration(string.format("%s\\MSBuild\\Current\\Bin\\MSBuild.exe", path), "Release", "Dist")
+	
+	if os.executef("cmake -S \"%s/\" -B \"%s/build/\" -G %q -D GLFW_USE_WAYLAND=1 -D USE_MSVC_RUNTIME_LIBRARY_DLL=0", scriptDir, scriptDir, buildTool) > 1 then
+		error("Failed to run cmake for glfw-3.3.8")
+	end
+	
+	msbuildConfiguration(string.format("%s\\MSBuild\\Current\\Bin\\MSBuild.exe", path), "Debug", "Debug", "s")
+	msbuildConfiguration(string.format("%s\\MSBuild\\Current\\Bin\\MSBuild.exe", path), "RelWithDebInfo", "Release", "s")
+	msbuildConfiguration(string.format("%s\\MSBuild\\Current\\Bin\\MSBuild.exe", path), "Release", "Dist", "s")
+else
+	error("Sorry, glfw-3.3.8 only supports windows atm, hehe :> (Couldn't be arsed to do make yet xD)")
+end
\ No newline at end of file
diff --git a/dep.lua b/dep.lua
new file mode 100644
index 0000000..7cc6bb6
--- /dev/null
+++ b/dep.lua
@@ -0,0 +1,16 @@
+filter("system:linux")
+	links({ "dl" })
+	linkoptions({ "-pthread" })
+
+filter("system:macosx")
+	links({
+		"CoreGraphics.framework",
+		"IOKit.framework",
+		"AppKit.framework"
+	})
+
+filter({})
+
+libdirs({ common:scriptDir() .. string.format("/Bin/%s-%s-", common.host, common.arch) .. "%{cfg.buildcfg}" })
+links({ "glfw3.lib" })
+externalincludedirs({ common:scriptDir() .. "/include/" })
\ No newline at end of file
-- 
2.38.1.windows.1

